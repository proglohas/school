<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç°¡è€å¸«çš„æ’åºæ³•è¨“ç·´ - é¸æ“‡æ’åºæƒæç‰ˆ</title>
    <style>
        body { 
            font-family: 'PingFang TC', sans-serif; 
            display: flex; flex-direction: column; align-items: center; 
            background-color: #f0f2f5; margin: 0; min-height: 100vh;
        }

        /* æµ®æ°´å° */
        body::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: -1;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><text x="50%" y="50%" font-size="24" fill="rgba(0,0,0,0.04)" font-family="Arial" text-anchor="middle" transform="rotate(-30, 200, 150)">ç°¡è€å¸«çš„æ’åºæ³•è¨“ç·´</text></svg>');
            background-repeat: repeat;
        }

        .container { margin-top: 30px; display: flex; flex-direction: column; gap: 20px; align-items: center; }
        .row { display: flex; gap: 12px; min-height: 150px; padding: 20px; background: rgba(0,0,0,0.05); border-radius: 10px; }
        
        .card {
            width: 70px; height: 100px; background: white; border: 2px solid #333;
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: bold; position: relative; transition: all 0.2s;
            user-select: none;
        }

        /* æƒæä¸­çš„æ¨£å¼ï¼ˆè—è‰²ç™¼å…‰ï¼‰ */
        .card.scanning { border-color: #0984e3; box-shadow: 0 0 15px #0984e3; transform: translateY(-5px); z-index: 2; }
        /* ç›®å‰æ‰¾åˆ°æœ€å°çš„æ¨£å¼ï¼ˆç²‰ç´…è‰²ï¼‰ */
        .card.min-found { border-color: #e84393; background: #fd79a8; color: white; }
        /* ç›®æ¨™ä½ç½®ï¼ˆç´…è™›æ¡†æ¨£å¼ï¼‰ */
        .target-slot { border: 3px dashed #ff7675 !important; background: #fff5f5; }

        .status { font-size: 1.2rem; font-weight: bold; height: 40px; margin-top: 10px; }
        .info { color: #0984e3; }
        .success { color: #27ae60; }
        .warning { color: #e67e22; }

        .controls { display: flex; gap: 10px; }
        button { padding: 10px 20px; cursor: pointer; border-radius: 5px; border: none; background: #636e72; color: white; font-size: 16px; }
        #swap-btn { background: #27ae60; display: none; }
    </style>
</head>
<body>

    <h2>ğŸƒ é¸æ“‡æ’åºï¼šä¸é‡è¤‡ç‰Œçµ„æƒææ¼”ç¤º</h2>
    <p style="color: #666;">æ¨¡æ“¬é›»è…¦é‚è¼¯ï¼šå¿…é ˆã€Œç”±å·¦è‡³å³ã€ä¾åºæƒæï¼Œç¢ºèªæœ€å°å€¼å¾Œæ‰èƒ½äº¤æ›ã€‚</p>

    <div class="container">
        <div id="upper-row" class="row"></div>
        <div class="controls">
            <button id="reload-btn">é‡æ–°æ´—ç‰Œ</button>
            <button id="swap-btn">åŸ·è¡Œäº¤æ› (Swap)</button>
        </div>
        <div id="message" class="status"></div>
    </div>



<script>
    const upperRow = document.getElementById('upper-row');
    const message = document.getElementById('message');
    const reloadBtn = document.getElementById('reload-btn');
    const swapBtn = document.getElementById('swap-btn');

    let cards = [];
    let sortedIndex = 0;   // ç›®å‰è¦å¡«å…¥çš„ä½ç½® (i)
    let scanIndex = 0;     // ç›®å‰æƒæåˆ°çš„ä½ç½® (j)
    let minIdxInScan = 0;  // ç›®å‰ç™¼ç¾çš„æœ€å°å€¼ index

    function init() {
        sortedIndex = 0;
        // ç”Ÿæˆ 1-13 ä¸é‡è¤‡çš„ 10 å¼µç‰Œ
        cards = Array.from({length: 13}, (_, i) => i + 1)
                     .sort(() => Math.random() - 0.5)
                     .slice(0, 10);
        startNewRound();
    }

    function startNewRound() {
        if (sortedIndex >= cards.length - 1) {
            showMessage("ğŸ‰ å…¨æ•¸æ’åºå®Œæˆï¼", "success");
            swapBtn.style.display = 'none';
            render();
            return;
        }
        scanIndex = sortedIndex; // å¾ i é–‹å§‹æƒæ
        minIdxInScan = sortedIndex; // æš«å®šç¬¬ä¸€å€‹ç‚ºæœ€å°
        swapBtn.style.display = 'none';
        showMessage(`è«‹é»æ“Šç´…æ¡†å³å´çš„ç‰Œé€²è¡Œã€Œæƒææ¯”è¼ƒã€`, "info");
        render();
    }

    function render() {
        upperRow.innerHTML = '';
        cards.forEach((val, i) => {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card';
            cardDiv.textContent = val;

            // å·²æ’åºå€åŸŸ
            if (i < sortedIndex) {
                cardDiv.style.opacity = "0.3";
                cardDiv.style.backgroundColor = "#eee";
            } 
            // ç›®å‰ç›®æ¨™ä½ç½® (i)
            else if (i === sortedIndex) {
                cardDiv.classList.add('target-slot');
            }

            // ç›®å‰æƒæä½ç½® (j)
            if (i === scanIndex && i >= sortedIndex) {
                cardDiv.classList.add('scanning');
            }
            // ç´€éŒ„ä¸­çš„æœ€å°å€¼
            if (i === minIdxInScan && i >= sortedIndex) {
                cardDiv.classList.add('min-found');
            }

            cardDiv.onclick = () => handleScan(i);
            upperRow.appendChild(cardDiv);
        });
    }

    function handleScan(idx) {
        // é™åˆ¶ 1ï¼šåªèƒ½æƒææœªæ’åºå€åŸŸ
        if (idx < sortedIndex) return;

        // é™åˆ¶ 2ï¼šå¿…é ˆæŒ‰ç…§é †åºæƒæ (j = j + 1)
        if (idx !== scanIndex + 1) {
            if (idx > scanIndex) {
                showMessage(`é›»è…¦å¿…é ˆä¸€å¼µä¸€å¼µæ¯”å°ï¼è«‹é»æ“Šç¬¬ ${scanIndex + 2} å¼µç‰Œã€‚`, "warning");
            }
            return;
        }

        scanIndex = idx;
        
        // æ¯”è¼ƒé‚è¼¯
        if (cards[scanIndex] < cards[minIdxInScan]) {
            minIdxInScan = scanIndex;
            showMessage(`å–”ï¼ç™¼ç¾æ›´å°çš„ ${cards[minIdxInScan]}ï¼Œç´€éŒ„èµ·ä¾†ï¼`, "success");
        } else {
            showMessage(`é€™å¼µæ²’æœ‰æ¯”è¼ƒå°ï¼Œç¹¼çºŒæƒæ...`, "info");
        }

        // æƒæå®Œç•¢æª¢æŸ¥
        if (scanIndex === cards.length - 1) {
            showMessage(`æƒæå®Œç•¢ï¼ç¾åœ¨å¯ä»¥å°‡ ${cards[minIdxInScan]} äº¤æ›åˆ°ç´…æ¡†ä½ç½®ã€‚`, "success");
            swapBtn.style.display = 'inline-block';
        }
        render();
    }

    swapBtn.onclick = () => {
        // åŸ·è¡Œ Swap
        let temp = cards[sortedIndex];
        cards[sortedIndex] = cards[minIdxInScan];
        cards[minIdxInScan] = temp;
        
        sortedIndex++;
        startNewRound();
    };

    reloadBtn.onclick = init;
    init();

    function showMessage(msg, type) {
        message.textContent = msg;
        message.className = 'status ' + type;
    }
</script>

</body>
</html>